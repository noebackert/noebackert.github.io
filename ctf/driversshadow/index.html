<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Driver's Shadow | Noé Backert | Blog</title><meta name=keywords content="Forensics,RAM,Volatility3"><meta name=description content="A critical Linux server began behaving erratically under suspected Volnaya interference, so a full memory snapshot was captured for analysis. Stealthy components embedded in the dump are altering system behavior and hiding their tracks; your task is to sift through the snapshot to uncover these concealed elements and extract any hidden payloads."><meta name=author content="Noé Backert"><link rel=canonical href=https://www.noe.backert.fr/ctf/driversshadow/><link crossorigin=anonymous href=/assets/css/stylesheet.2211ca3164be7830024f6aad2b3a2e520843a64f8f048445c3401c1249aa051d.css integrity="sha256-IhHKMWS+eDACT2qtKzouUghDpk+PBIRFw0AcEkmqBR0=" rel="preload stylesheet" as=style><link rel=icon href=https://www.noe.backert.fr/img/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://www.noe.backert.fr/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://www.noe.backert.fr/favicon-32x32.png><link rel=apple-touch-icon href=https://www.noe.backert.fr/apple-touch-icon.png><link rel=mask-icon href=https://www.noe.backert.fr/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://www.noe.backert.fr/ctf/driversshadow/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><link rel=stylesheet href=/css/custom.css><meta property="og:url" content="https://www.noe.backert.fr/ctf/driversshadow/"><meta property="og:site_name" content="Noé Backert | Blog"><meta property="og:title" content="Driver's Shadow"><meta property="og:description" content="A critical Linux server began behaving erratically under suspected Volnaya interference, so a full memory snapshot was captured for analysis. Stealthy components embedded in the dump are altering system behavior and hiding their tracks; your task is to sift through the snapshot to uncover these concealed elements and extract any hidden payloads."><meta property="og:locale" content="en-us"><meta property="og:type" content="article"><meta property="article:section" content="ctf"><meta property="article:published_time" content="2025-05-25T15:00:00+02:00"><meta property="article:modified_time" content="2025-05-25T15:00:00+02:00"><meta property="article:tag" content="Forensics"><meta property="article:tag" content="RAM"><meta property="article:tag" content="Volatility3"><meta name=twitter:card content="summary"><meta name=twitter:title content="Driver's Shadow"><meta name=twitter:description content="A critical Linux server began behaving erratically under suspected Volnaya interference, so a full memory snapshot was captured for analysis. Stealthy components embedded in the dump are altering system behavior and hiding their tracks; your task is to sift through the snapshot to uncover these concealed elements and extract any hidden payloads."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"CTFs","item":"https://www.noe.backert.fr/ctf/"},{"@type":"ListItem","position":2,"name":"Driver's Shadow","item":"https://www.noe.backert.fr/ctf/driversshadow/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Driver's Shadow","name":"Driver\u0027s Shadow","description":"A critical Linux server began behaving erratically under suspected Volnaya interference, so a full memory snapshot was captured for analysis. Stealthy components embedded in the dump are altering system behavior and hiding their tracks; your task is to sift through the snapshot to uncover these concealed elements and extract any hidden payloads.","keywords":["Forensics","RAM","Volatility3"],"articleBody":"HTB Link - github.com/hackthebox/business-ctf-2025\nSolution Installation / tools We are given a .elf file ~2Go, it says it’s a memory capture. We’ll then try to analyse it using volatility3.\npython3 vol.py -f mem.elf banners\nIt returns something like : 0x10399cd0 Linux version 6.1.0-34-amd64 (debian-kernel@lists.debian.org) (gcc-12 (Debian 12.2.0-14+deb12u1) 12.2.0, GNU ld (GNU Binutils for Debian) 2.40) #1 SMP PREEMPT_DYNAMIC Debian 6.1.135-1 (2025-04-25)\nTo be able to analyse this kernel (6.1.0-34-amd64), we have to find the exact matching banner symbol table. A lot of them are available on : https://github.com/Abyss-W4tcher/volatility3-symbols/tree/master\nConvert the beginning of the banner in base64 to Linux version 6.1.0-34-amd64 (debian-kernel@lists.debian.org) (gcc-12 (Debian 12.2.0-14+deb12u1) 12.2.0, GNU ld (GNU Binutils for Debian) 2.40) #1 SMP PREEMPT_DYNAMIC Debian 6.1.135-1 -\u003e TGludXggdmVyc2lvbiA2LjEuMC0zNC1hbWQ2NCAoZGViaWFuLWtlcm5lbEBsaXN0cy5kZWJpYW4ub3JnKSAoZ2NjLTEyIChEZWJpYW4gMTIuMi4wLTE0K2RlYjEydTEpIDEyLjIuMCwgR05VIGxkIChHTlUgQmludXRpbHMgZm9yIERlYmlhbikgMi40MCkgIzEgU01QIFBSRUVNUFRfRFlOQU1JQyBEZWJpYW4gNi4xLjEzNS0x Find a match from banners.json, download it using the link and extract the .gz to the volatility3/volatility3/symbols folder.\nWe’re now able to use linux plugins with the RAM dump!\nFlag 1/10 - What is the name of the backdoor udev Rule (ex:10-name.rules) Using the linux.pagecache.Files plugin, we can search for rules using regex : \\b\\d{2}-[a-zA-Z0-9_-]+\\.rules\\b\nWe then find a line with a weird rule name : 99-volnaya.rules 0x9a097453c800\t/\t8:1\t652915\t0x9a0974b66798\tREG\t1\t1\t-rw-r--r--\t2025-05-12 19:19:55.919384 UTC\t2025-05-12 19:20:29.372000 UTC\t2025-05-12 19:20:29.372000 UTC\t/etc/udev/rules.d/99-volnaya.rules\t77\nFlag 2/10 - What is the name of the kernel module ? A simple volatility3 request using linux.hidden_modules : 0xffffc09804c0\tvolnaya_xb127\t0x4000\tOOT_MODULE,UNSIGNED_MODULE\tN/A We find volnaya_xb127 as the module name\nFlag 3/10 - What is the resolved IP of the attacker ? Using linux.sockstat plugin:\n1 4026531840\tbash\t2957\t2957\t0\t0x9a094804a400\tAF_INET\tSTREAM\tTCP\t10.0.2.15\t55522\t16.171.55.6\t4421\tESTABLISHED\t- We find the remote IP address: 16.171.55.6\nFlag 4/10 - What is the address of __x64_sys_kill, __x64_sys_getdents64 (ex: kill:getdents64) Using linux.kallsyms plugin:\n1 2 3 0xffffb88b6bf0\tT\t176\tTrue\tcore\tkernel\t__x64_sys_kill\tSymbol is in the text (code) section 0xffffb8b7c770\tT\t288\tTrue\tcore\tkernel\t__x64_sys_getdents64\tSymbol is in the text (code) section Flag: 0xffffb88b6bf0:0xffffb8b7c770\nFlag 5/10 - What __SYSCALLS__ are hooked with ftrace, sorted via SYSCALL number (ex: read:write:open) Using linux.tracing.ftrace.CheckFtrace plugin:\n1 2 3 4 5 0xffffc09803a0\t-\t0xffffc097e200\tfilldir64\tvolnaya_xb127\t0xffffc097e000 0xffffc09802c8\t-\t0xffffc097e200\tfilldir\tvolnaya_xb127\t0xffffc097e000 0xffffc09801f0\t-\t0xffffc097e200\tfillonedir\tvolnaya_xb127\t0xffffc097e000 0xffffc0980118\t-\t0xffffc097e200\t__x64_sys_kill\tvolnaya_xb127\t0xffffc097e000 0xffffc0980040\t-\t0xffffc097e200\t__x64_sys_getdents64\tvolnaya_xb127\t0xffffc097e000 Only __x64_sys_kill and __x64_sys_getdents64 are syscall\nFlag: kill:getdents64\nFlag 6/10 There is one bash process that is hidden in __USERSPACE__, what is its PID What is the resolved IP of the attacke In the __USER_SPACE__ (UID 1000, GID 1000 for the standard user), there’s a lot of bash processes 0x9a0946310000\t2957\t2957\t1750\tbash\t0\t0\t0\t0\t2025-05-12 19:23:34.894489 UTC\tDisabled\nUsing linux.pslist, we can see that only 1 bash script runs with UID:0 \u0026 GID 0: 2957\t1750\tbash\tSUDO_COMMAND\t/usr/bin/volnaya_usr rsh\nWe enter PID 2957, flag : 2957\nFlag 7/10 - What is the XOR key used (ex: 0011aabb) In the linux.envars, we can see the line : 2957\t1750\tbash\tSUDO_COMMAND\t/usr/bin/volnaya_usr rsh We try to recover this binary file to analyse it further using linux.pagecache.RecoverFs plugin:\nUsing readelf -a volnaya_usr on the recovered binary, we can inspect what it contains: In the .symtab section, we see interesting entries :\n1 2 3 4 51: 00000000000040e0 28 OBJECT GLOBAL DEFAULT 25 hostname 52: 000000000006a7e0 0 NOTYPE GLOBAL DEFAULT 26 __bss_start 53: 0000000000001755 261 FUNC GLOBAL DEFAULT 15 main 54: 0000000000004100 16 OBJECT GLOBAL DEFAULT 25 xor_key We find that hostname is stored at the virtual address 00000000000040e0 and xor_key at the address 0000000000004100\nWe search for the data’s offset :\n1 2 -[~/HTBCTF]$ readelf -S volnaya_usr | grep '\\.data' [25] .data PROGBITS 00000000000040c0 000030c0 So we can calculate the real addresses of hostname (28 bytes) and xor_key (16 bytes)\nThe address is calculated with : VirtualAddress - Address Data (0x00000000000040c0) + offset (0x000030c0)\nName Virtual Address Offset Address xor_key 0000000000004100 000030c0 0000000000003100 hostname 00000000000040e0 000030c0 00000000000030e0 We retrieve 16 bytes starting at 0x3100, we find the xor_key : 1 2 -[~/HTBCTF]$ xxd -s 0x3100 -l 16 volnaya_usr # xor_key 00003100: 881b a50d 42a4 3079 1ca2 d9ce 0630 f5c9 ....B.0y.....0.. Flag : 881ba50d42a430791ca2d9ce0630f5c9\nFlag 8/10 - What is the hostname the rootkit connects to We make the same process than the previous flag :\n1 2 3 -[~/HTBCTF]$ xxd -s 0x30e0 -l 28 volnaya_usr 000030e0: eb7a c961 20c5 5312 32c1 b7ad 3408 c4f8 .z.a .S.2...4... 000030f0: a66d ca61 2cc5 4918 32ca adac .m.a,.I.2... We see that the data is not in clear text, we try to xor it using the previous found key, we have : We find a good value : callback.cnc2811.volnaya.htb\nFlag 9/10 - What owner UID and GID membership will make the file hidden (UID:GID) Extract the hidden kernel module using the linux.module_extract plugin : python vol.py -f mem.elf linux.module_extract --base 0xffffc09804c0 The base address is found using hidden_module plugin.\nAnalyse it using ghidra or readelf kernel_module.volnaya_xb127.0xffffc09804c0.elf -a\nWe find interesting 4 bytes variables :\n1 2 22: 0000000000000454 4 OBJECT GLOBAL DEFAULT 12 GROUP_HIDE 34: 0000000000000458 4 OBJECT GLOBAL DEFAULT 12 USER_HIDE Exploring toggle_hide_proc function in ghidra, we find out, that the function’s goal is to check if the PID is already in the “hide” list.\nIf so, it removes it from the list — i.e., un-hides it. If not, it adds it to the list — i.e., hides it. Element Purpose toggle_hide_proc Toggle PID in hide/unhide list DAT_ffffffffc0a80460 Head of the hidden PID list List structure Doubly linked list (prev/next) Hidden if present In the list Unhidden if removed From the list By exploring further, we see inside the function patched_getdents64 : 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 void patched_getdents64(long param_1,int param_2,undefined4 param_3) { long lVar1; int iVar2; undefined8 *puVar3; int iVar4; long lVar5; long lVar6; long lVar7; ulong uVar8; ulong uVar9; long in_GS_OFFSET; int local_4c; long local_48; int local_3c; long local_38; uVar9 = (ulong)param_2; local_38 = *(long *)(in_GS_OFFSET + 0x28); lVar5 = func_0xffffffffb8bb4230(_DAT_ffffffffb9d29210,0xdc0,0x98); lVar6 = func_0xffffffffb8bb4d80(uVar9,0xdc0); if (lVar6 != 0) { if (0x7fffffff \u003c uVar9) { LAB_ffffffffc0a7ed2a: do { invalidInstructionException(); } while( true ); } func_0xffffffffb8c57980(lVar6,uVar9,0); iVar4 = func_0xffffffffb8e345a0(lVar6,param_1,uVar9); if (iVar4 == 0) { lookup_name(0xffffffffc097f0f0); if (uVar9 != 0) { local_48 = 0; uVar8 = 0; local_4c = param_2; do { lVar1 = lVar6 + uVar8; iVar4 = func_0xffffffffb9701580(param_3,param_1 + 0x13 + uVar8,lVar5,0); if (iVar4 != 0) goto LAB_ffffffffc0a7ecd0; iVar4 = *(int *)(lVar5 + 0x30); iVar2 = *(int *)(lVar5 + 0x34); lVar7 = func_0xffffffffb92daba0(lVar1 + 0x13,DAT_ffffffffc0a80480); if (lVar7 == 0) { local_3c = 0; func_0xffffffffb8e36d90(lVar1 + 0x13,10,\u0026local_3c); for (puVar3 = DAT_ffffffffc0a80460; puVar3 != (undefined8 *)0xffffffffc0980460; puVar3 = (undefined8 *)*puVar3) { if (*(int *)(puVar3 + -1) == local_3c) goto LAB_ffffffffc0a7ebb8; } if ((DAT_ffffffffc0a80478 == iVar4) || (lVar7 = lVar1, DAT_ffffffffc0a80474 == iVar2)) goto LAB_ffffffffc0a7ebb8; LAB_ffffffffc0a7ebcf: local_48 = lVar7; uVar8 = uVar8 + *(ushort *)(lVar1 + 0x10); } else { LAB_ffffffffc0a7ebb8: if (lVar1 != lVar6) { *(short *)(local_48 + 0x10) = *(short *)(local_48 + 0x10) + *(short *)(lVar1 + 0x10); lVar7 = local_48; goto LAB_ffffffffc0a7ebcf; } local_4c = local_4c - (uint)*(ushort *)(lVar6 + 0x10); uVar9 = (ulong)local_4c; func_0xffffffffb92e7dc0(lVar6,(ulong)*(ushort *)(lVar6 + 0x10) + lVar6,uVar9); } } while (uVar8 \u003c uVar9); if (0x7fffffff \u003c uVar9) goto LAB_ffffffffc0a7ed2a; } func_0xffffffffb8c57980(lVar6,uVar9,1); func_0xffffffffb8e344a0(param_1,lVar6,uVar9); } LAB_ffffffffc0a7ecd0: func_0xffffffffb8bb4680(lVar5); func_0xffffffffb8bb4680(lVar6); } if (local_38 == *(long *)(in_GS_OFFSET + 0x28)) { /* WARNING: Bad instruction - Truncating control flow here */ halt_baddata(); } func_0xffffffffb9336610(); return; } We can see the followings :\n1 2 iVar4 = *(int *)(lVar5 + 0x30); // UID of the entry iVar2 = *(int *)(lVar5 + 0x34); // GID of the entry So, it’s reading the UID and GID of the file or process entry returned by getdents64. Then, they compare them to the values stored at :\n1 2 if ((DAT_ffffffffc0a80478 == iVar4) || (lVar7 = lVar1, DAT_ffffffffc0a80474 == iVar2)) goto LAB_ffffffffc0a7ebb8; DAT_ffffffffc0a80478 → UID to hide DAT_ffffffffc0a80474 → GID to hide If either matches the current entry’s UID or GID: It skips showing that entry by jumping to a block (LAB_ffffffffc0a7ebb8) that merges/skips it. By looking at thoses values, we find : GID -\u003e DAT_ffffffffc0a80474 -\u003e 000007C8h -\u003e 1992 UID -\u003e DAT_ffffffffc0a80478 -\u003e 0000071Dh -\u003e 1821\nFlag: 1821:1992\nFlag 10/10 - What string must be contained in a file in order to be hidden I don’t really now how to link it with the program as I found it by chance.. Flag: volnaya\n","wordCount":"1451","inLanguage":"en","datePublished":"2025-05-25T15:00:00+02:00","dateModified":"2025-05-25T15:00:00+02:00","author":{"@type":"Person","name":"Noé Backert"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://www.noe.backert.fr/ctf/driversshadow/"},"publisher":{"@type":"Organization","name":"Noé Backert | Blog","logo":{"@type":"ImageObject","url":"https://www.noe.backert.fr/img/favicon.ico"}}}</script><script>window.MathJax={tex:{inlineMath:[["\\(","\\)"],["$","$"]],displayMath:[["$$","$$"],["\\[","\\]"]]},options:{skipHtmlTags:["script","noscript","style","textarea","pre","code"]}}</script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js async></script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://www.noe.backert.fr/ accesskey=h title="Noé Backert | Blog (Alt + H)">Noé Backert | Blog</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://www.noe.backert.fr/ title=Home><span>Home</span></a></li><li><a href=https://www.noe.backert.fr/resume/ title=Resume><span>Resume</span></a></li><li><a href=https://www.noe.backert.fr/ctf/ title="CTF Writeups"><span>CTF Writeups</span></a></li><li><a href=https://www.noe.backert.fr/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://www.noe.backert.fr/tags/ title=Tags><span>Tags</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://www.noe.backert.fr/>Home</a>&nbsp;»&nbsp;<a href=https://www.noe.backert.fr/ctf/>CTFs</a></div><h1 class="post-title entry-hint-parent"><span class=ctf-platform-title>HTB</span><span class=ctf-platform-separator> &mdash; </span>Driver's Shadow</h1><div class=post-description>A critical Linux server began behaving erratically under suspected Volnaya interference, so a full memory snapshot was captured for analysis. Stealthy components embedded in the dump are altering system behavior and hiding their tracks; your task is to sift through the snapshot to uncover these concealed elements and extract any hidden payloads.</div><div class=post-meta><span title='2025-05-25 15:00:00 +0200 +0200'>May 25, 2025</span>&nbsp;·&nbsp;7 min&nbsp;·&nbsp;Noé Backert</div></header><div class=post-content><p><a href="https://github.com/hackthebox/business-ctf-2025/tree/master/forensics/Driver's%20Shadow">HTB Link - github.com/hackthebox/business-ctf-2025</a></p><h1 id=solution>Solution<a hidden class=anchor aria-hidden=true href=#solution>#</a></h1><h2 id=installation--tools>Installation / tools<a hidden class=anchor aria-hidden=true href=#installation--tools>#</a></h2><p>We are given a .elf file ~2Go, it says it&rsquo;s a memory capture. We&rsquo;ll then try to analyse it using volatility3.</p><p><code>python3 vol.py -f mem.elf banners</code></p><p>It returns something like :
<code>0x10399cd0 Linux version 6.1.0-34-amd64 (debian-kernel@lists.debian.org) (gcc-12 (Debian 12.2.0-14+deb12u1) 12.2.0, GNU ld (GNU Binutils for Debian) 2.40) #1 SMP PREEMPT_DYNAMIC Debian 6.1.135-1 (2025-04-25)</code></p><p>To be able to analyse this kernel (6.1.0-34-amd64), we have to find the exact matching banner symbol table.
A lot of them are available on :
<a href=https://github.com/Abyss-W4tcher/volatility3-symbols/tree/master>https://github.com/Abyss-W4tcher/volatility3-symbols/tree/master</a></p><p>Convert the beginning of the banner in base64 to
<code>Linux version 6.1.0-34-amd64 (debian-kernel@lists.debian.org) (gcc-12 (Debian 12.2.0-14+deb12u1) 12.2.0, GNU ld (GNU Binutils for Debian) 2.40) #1 SMP PREEMPT_DYNAMIC Debian 6.1.135-1</code>
->
<code>TGludXggdmVyc2lvbiA2LjEuMC0zNC1hbWQ2NCAoZGViaWFuLWtlcm5lbEBsaXN0cy5kZWJpYW4ub3JnKSAoZ2NjLTEyIChEZWJpYW4gMTIuMi4wLTE0K2RlYjEydTEpIDEyLjIuMCwgR05VIGxkIChHTlUgQmludXRpbHMgZm9yIERlYmlhbikgMi40MCkgIzEgU01QIFBSRUVNUFRfRFlOQU1JQyBEZWJpYW4gNi4xLjEzNS0x</code>
<img alt="Association of base64 encoded linux banners & links to volatility3 profiles " loading=lazy src=/img/ctf/driverShadow/profile.png></p><p>Find a match from banners.json, download it using the link and extract the .gz to the <code>volatility3/volatility3/symbols</code> folder.</p><p>We&rsquo;re now able to use linux plugins with the RAM dump!</p><h3 id=flag-110---what-is-the-name-of-the-backdoor-udev-rule-ex10-namerules>Flag 1/10 - What is the name of the backdoor udev Rule (ex:10-name.rules)<a hidden class=anchor aria-hidden=true href=#flag-110---what-is-the-name-of-the-backdoor-udev-rule-ex10-namerules>#</a></h3><p>Using the linux.pagecache.Files plugin, we can search for rules using regex : <code>\b\d{2}-[a-zA-Z0-9_-]+\.rules\b</code></p><p>We then find a line with a weird rule name : <strong>99-volnaya.rules</strong>
<code>0x9a097453c800 / 8:1 652915 0x9a0974b66798 REG 1 1 -rw-r--r-- 2025-05-12 19:19:55.919384 UTC 2025-05-12 19:20:29.372000 UTC 2025-05-12 19:20:29.372000 UTC /etc/udev/rules.d/99-volnaya.rules 77</code></p><h3 id=flag-210---what-is-the-name-of-the-kernel-module->Flag 2/10 - What is the name of the kernel module ?<a hidden class=anchor aria-hidden=true href=#flag-210---what-is-the-name-of-the-kernel-module->#</a></h3><p>A simple volatility3 request using linux.hidden_modules :
<code>0xffffc09804c0 volnaya_xb127 0x4000 OOT_MODULE,UNSIGNED_MODULE N/A</code>
We find <strong>volnaya_xb127</strong> as the module name</p><h3 id=flag-310---what-is-the-resolved-ip-of-the-attacker->Flag 3/10 - What is the resolved IP of the attacker ?<a hidden class=anchor aria-hidden=true href=#flag-310---what-is-the-resolved-ip-of-the-attacker->#</a></h3><p>Using linux.sockstat plugin:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>4026531840	bash	2957	2957	0	0x9a094804a400	AF_INET	STREAM	TCP	10.0.2.15	55522	16.171.55.6	4421	ESTABLISHED	-
</span></span></code></pre></td></tr></table></div></div><p>We find the remote IP address: <code>16.171.55.6</code></p><h3 id=flag-410---what-is-the-address-of-__x64_sys_kill-__x64_sys_getdents64-ex-killgetdents64>Flag 4/10 - What is the address of __x64_sys_kill, __x64_sys_getdents64 (ex: kill:getdents64)<a hidden class=anchor aria-hidden=true href=#flag-410---what-is-the-address-of-__x64_sys_kill-__x64_sys_getdents64-ex-killgetdents64>#</a></h3><p>Using linux.kallsyms plugin:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0xffffb88b6bf0	T	176	True	core	kernel	__x64_sys_kill	Symbol is in the text (code) section
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>0xffffb8b7c770	T	288	True	core	kernel	__x64_sys_getdents64	Symbol is in the text (code) section
</span></span></code></pre></td></tr></table></div></div><p>Flag: <code>0xffffb88b6bf0:0xffffb8b7c770</code></p><h3 id=flag-510---what-__syscalls__-are-hooked-with-ftrace-sorted-via-syscall-number-ex-readwriteopen>Flag 5/10 - What <code>__SYSCALLS__</code> are hooked with ftrace, sorted via SYSCALL number (ex: read:write:open)<a hidden class=anchor aria-hidden=true href=#flag-510---what-__syscalls__-are-hooked-with-ftrace-sorted-via-syscall-number-ex-readwriteopen>#</a></h3><p>Using linux.tracing.ftrace.CheckFtrace plugin:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span><span class=lnt>5
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>0xffffc09803a0	-	0xffffc097e200	filldir64	volnaya_xb127	0xffffc097e000
</span></span><span class=line><span class=cl>0xffffc09802c8	-	0xffffc097e200	filldir	volnaya_xb127	0xffffc097e000
</span></span><span class=line><span class=cl>0xffffc09801f0	-	0xffffc097e200	fillonedir	volnaya_xb127	0xffffc097e000
</span></span><span class=line><span class=cl>0xffffc0980118	-	0xffffc097e200	__x64_sys_kill	volnaya_xb127	0xffffc097e000
</span></span><span class=line><span class=cl>0xffffc0980040	-	0xffffc097e200	__x64_sys_getdents64	volnaya_xb127	0xffffc097e000
</span></span></code></pre></td></tr></table></div></div><p>Only __x64_sys_kill and __x64_sys_getdents64 are syscall</p><p>Flag: <code>kill:getdents64</code></p><h3 id=flag-610-there-is-one-bash-process-that-is-hidden-in-__userspace__-what-is-its-pid>Flag 6/10 There is one bash process that is hidden in <code>__USERSPACE__</code>, what is its PID<a hidden class=anchor aria-hidden=true href=#flag-610-there-is-one-bash-process-that-is-hidden-in-__userspace__-what-is-its-pid>#</a></h3><p>What is the resolved IP of the attacke
In the <code>__USER_SPACE__</code> (UID 1000, GID 1000 for the standard user), there&rsquo;s a lot of bash processes
<code>0x9a0946310000 2957 2957 1750 bash 0 0 0 0 2025-05-12 19:23:34.894489 UTC Disabled</code></p><p>Using linux.pslist, we can see that only 1 bash script runs with UID:0 & GID 0:
<code>2957 1750 bash SUDO_COMMAND /usr/bin/volnaya_usr rsh</code></p><p>We enter PID 2957, flag : <code>2957</code></p><h3 id=flag-710---what-is-the-xor-key-used-ex-0011aabb>Flag 7/10 - What is the XOR key used (ex: 0011aabb)<a hidden class=anchor aria-hidden=true href=#flag-710---what-is-the-xor-key-used-ex-0011aabb>#</a></h3><p>In the linux.envars, we can see the line :
<code>2957 1750 bash SUDO_COMMAND /usr/bin/volnaya_usr rsh</code>
We try to recover this binary file to analyse it further using <code>linux.pagecache.RecoverFs</code> plugin:</p><p>Using <code>readelf -a volnaya_usr</code> on the recovered binary, we can inspect what it contains:
In the .symtab section, we see interesting entries :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>51: 00000000000040e0    28 OBJECT  GLOBAL DEFAULT   25 hostname
</span></span><span class=line><span class=cl>52: 000000000006a7e0     0 NOTYPE  GLOBAL DEFAULT   26 __bss_start
</span></span><span class=line><span class=cl>53: 0000000000001755   261 FUNC    GLOBAL DEFAULT   15 main
</span></span><span class=line><span class=cl>54: 0000000000004100    16 OBJECT  GLOBAL DEFAULT   25 xor_key
</span></span></code></pre></td></tr></table></div></div><p>We find that <code>hostname</code> is stored at the virtual address <code>00000000000040e0</code> and <code>xor_key</code> at the address <code>0000000000004100</code></p><p>We search for the data&rsquo;s offset :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>-[~/HTBCTF]$ readelf -S volnaya_usr | grep &#39;\.data&#39;
</span></span><span class=line><span class=cl>  [25] .data             PROGBITS         00000000000040c0  000030c0
</span></span></code></pre></td></tr></table></div></div><p>So we can calculate the real addresses of hostname (28 bytes) and xor_key (16 bytes)</p><p>The address is calculated with :
VirtualAddress - Address Data (0x00000000000040c0) + offset (0x000030c0)</p><table><thead><tr><th>Name</th><th>Virtual Address</th><th>Offset</th><th>Address</th></tr></thead><tbody><tr><td>xor_key</td><td>0000000000004100</td><td>000030c0</td><td>0000000000003100</td></tr><tr><td>hostname</td><td>00000000000040e0</td><td>000030c0</td><td>00000000000030e0</td></tr><tr><td>We retrieve 16 bytes starting at 0x3100, we find the xor_key :</td><td></td><td></td><td></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>-<span class=o>[</span>~/HTBCTF<span class=o>]</span>$ xxd -s 0x3100 -l <span class=m>16</span> volnaya_usr   <span class=c1># xor_key</span>
</span></span><span class=line><span class=cl>00003100: 881b a50d 42a4 <span class=m>3079</span> 1ca2 d9ce <span class=m>0630</span> f5c9  ....B.0y.....0..
</span></span></code></pre></td></tr></table></div></div><p>Flag : <code>881ba50d42a430791ca2d9ce0630f5c9</code></p><h3 id=flag-810---what-is-the-hostname-the-rootkit-connects-to>Flag 8/10 - What is the hostname the rootkit connects to<a hidden class=anchor aria-hidden=true href=#flag-810---what-is-the-hostname-the-rootkit-connects-to>#</a></h3><p>We make the same process than the previous flag :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-sh data-lang=sh><span class=line><span class=cl>-<span class=o>[</span>~/HTBCTF<span class=o>]</span>$ xxd -s 0x30e0 -l <span class=m>28</span> volnaya_usr
</span></span><span class=line><span class=cl>000030e0: eb7a c961 20c5 <span class=m>5312</span> 32c1 b7ad <span class=m>3408</span> c4f8  .z.a .S.2...4...
</span></span><span class=line><span class=cl>000030f0: a66d ca61 2cc5 <span class=m>4918</span> 32ca adac            .m.a,.I.2...
</span></span></code></pre></td></tr></table></div></div><p>We see that the data is not in clear text, we try to xor it using the previous found key, we have :
<img alt="Retrieved domain name using the xor key" loading=lazy src=/img/ctf/driverShadow/domainXOR.png></p><p>We find a good value :
<code>callback.cnc2811.volnaya.htb</code></p><h3 id=flag-910---what-owner-uid-and-gid-membership-will-make-the-file-hidden-uidgid>Flag 9/10 - What owner UID and GID membership will make the file hidden (UID:GID)<a hidden class=anchor aria-hidden=true href=#flag-910---what-owner-uid-and-gid-membership-will-make-the-file-hidden-uidgid>#</a></h3><ol><li><p>Extract the hidden kernel module using the linux.module_extract plugin :
<code>python vol.py -f mem.elf linux.module_extract --base 0xffffc09804c0</code>
The base address is found using hidden_module plugin.</p></li><li><p>Analyse it using ghidra or <code>readelf kernel_module.volnaya_xb127.0xffffc09804c0.elf -a</code></p></li></ol><p>We find interesting 4 bytes variables :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-fallback data-lang=fallback><span class=line><span class=cl>22: 0000000000000454     4 OBJECT  GLOBAL DEFAULT   12 GROUP_HIDE
</span></span><span class=line><span class=cl>34: 0000000000000458     4 OBJECT  GLOBAL DEFAULT   12 USER_HIDE
</span></span></code></pre></td></tr></table></div></div><p>Exploring <code>toggle_hide_proc</code> function in ghidra, we find out, that the function&rsquo;s goal is to check if the PID is already in the &ldquo;hide&rdquo; list.</p><ul><li>If so, it <strong>removes</strong> it from the list — i.e., un-hides it.</li><li>If not, it <strong>adds</strong> it to the list — i.e., hides it.</li></ul><table><thead><tr><th>Element</th><th>Purpose</th></tr></thead><tbody><tr><td><code>toggle_hide_proc</code></td><td>Toggle PID in hide/unhide list</td></tr><tr><td><code>DAT_ffffffffc0a80460</code></td><td>Head of the hidden PID list</td></tr><tr><td>List structure</td><td>Doubly linked list (prev/next)</td></tr><tr><td>Hidden if present</td><td>In the list</td></tr><tr><td>Unhidden if removed</td><td>From the list</td></tr><tr><td>By exploring further, we see inside the function patched_getdents64 :</td><td></td></tr></tbody></table><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=kt>void</span> <span class=nf>patched_getdents64</span><span class=p>(</span><span class=kt>long</span> <span class=n>param_1</span><span class=p>,</span><span class=kt>int</span> <span class=n>param_2</span><span class=p>,</span><span class=n>undefined4</span> <span class=n>param_3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>lVar1</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>iVar2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>undefined8</span> <span class=o>*</span><span class=n>puVar3</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>iVar4</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>lVar5</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>lVar6</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>lVar7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ulong</span> <span class=n>uVar8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>ulong</span> <span class=n>uVar9</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>in_GS_OFFSET</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>local_4c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>local_48</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>int</span> <span class=n>local_3c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=kt>long</span> <span class=n>local_38</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  
</span></span><span class=line><span class=cl>  <span class=n>uVar9</span> <span class=o>=</span> <span class=p>(</span><span class=n>ulong</span><span class=p>)</span><span class=n>param_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>  <span class=n>local_38</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_GS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>lVar5</span> <span class=o>=</span> <span class=nf>func_0xffffffffb8bb4230</span><span class=p>(</span><span class=n>_DAT_ffffffffb9d29210</span><span class=p>,</span><span class=mh>0xdc0</span><span class=p>,</span><span class=mh>0x98</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=n>lVar6</span> <span class=o>=</span> <span class=nf>func_0xffffffffb8bb4d80</span><span class=p>(</span><span class=n>uVar9</span><span class=p>,</span><span class=mh>0xdc0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>lVar6</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=mh>0x7fffffff</span> <span class=o>&lt;</span> <span class=n>uVar9</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nl>LAB_ffffffffc0a7ed2a</span><span class=p>:</span>
</span></span><span class=line><span class=cl>      <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nf>invalidInstructionException</span><span class=p>();</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span> <span class=k>while</span><span class=p>(</span> <span class=nb>true</span> <span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=nf>func_0xffffffffb8c57980</span><span class=p>(</span><span class=n>lVar6</span><span class=p>,</span><span class=n>uVar9</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=n>iVar4</span> <span class=o>=</span> <span class=nf>func_0xffffffffb8e345a0</span><span class=p>(</span><span class=n>lVar6</span><span class=p>,</span><span class=n>param_1</span><span class=p>,</span><span class=n>uVar9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=p>(</span><span class=n>iVar4</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=nf>lookup_name</span><span class=p>(</span><span class=mh>0xffffffffc097f0f0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=k>if</span> <span class=p>(</span><span class=n>uVar9</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=n>local_48</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>uVar8</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=n>local_4c</span> <span class=o>=</span> <span class=n>param_2</span><span class=p>;</span>
</span></span><span class=line><span class=cl>        <span class=k>do</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>          <span class=n>lVar1</span> <span class=o>=</span> <span class=n>lVar6</span> <span class=o>+</span> <span class=n>uVar8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>iVar4</span> <span class=o>=</span> <span class=nf>func_0xffffffffb9701580</span><span class=p>(</span><span class=n>param_3</span><span class=p>,</span><span class=n>param_1</span> <span class=o>+</span> <span class=mh>0x13</span> <span class=o>+</span> <span class=n>uVar8</span><span class=p>,</span><span class=n>lVar5</span><span class=p>,</span><span class=mi>0</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=n>iVar4</span> <span class=o>!=</span> <span class=mi>0</span><span class=p>)</span> <span class=k>goto</span> <span class=n>LAB_ffffffffc0a7ecd0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>          <span class=n>iVar4</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar5</span> <span class=o>+</span> <span class=mh>0x30</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=n>iVar2</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar5</span> <span class=o>+</span> <span class=mh>0x34</span><span class=p>);</span> 
</span></span><span class=line><span class=cl>          <span class=n>lVar7</span> <span class=o>=</span> <span class=nf>func_0xffffffffb92daba0</span><span class=p>(</span><span class=n>lVar1</span> <span class=o>+</span> <span class=mh>0x13</span><span class=p>,</span><span class=n>DAT_ffffffffc0a80480</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=k>if</span> <span class=p>(</span><span class=n>lVar7</span> <span class=o>==</span> <span class=mi>0</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=n>local_3c</span> <span class=o>=</span> <span class=mi>0</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>func_0xffffffffb8e36d90</span><span class=p>(</span><span class=n>lVar1</span> <span class=o>+</span> <span class=mh>0x13</span><span class=p>,</span><span class=mi>10</span><span class=p>,</span><span class=o>&amp;</span><span class=n>local_3c</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=p>(</span><span class=n>puVar3</span> <span class=o>=</span> <span class=n>DAT_ffffffffc0a80460</span><span class=p>;</span> <span class=n>puVar3</span> <span class=o>!=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=mh>0xffffffffc0980460</span><span class=p>;</span>
</span></span><span class=line><span class=cl>                <span class=n>puVar3</span> <span class=o>=</span> <span class=p>(</span><span class=n>undefined8</span> <span class=o>*</span><span class=p>)</span><span class=o>*</span><span class=n>puVar3</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>if</span> <span class=p>(</span><span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>puVar3</span> <span class=o>+</span> <span class=o>-</span><span class=mi>1</span><span class=p>)</span> <span class=o>==</span> <span class=n>local_3c</span><span class=p>)</span> <span class=k>goto</span> <span class=n>LAB_ffffffffc0a7ebb8</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>((</span><span class=n>DAT_ffffffffc0a80478</span> <span class=o>==</span> <span class=n>iVar4</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=n>lVar7</span> <span class=o>=</span> <span class=n>lVar1</span><span class=p>,</span> <span class=n>DAT_ffffffffc0a80474</span> <span class=o>==</span> <span class=n>iVar2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            <span class=k>goto</span> <span class=n>LAB_ffffffffc0a7ebb8</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=nl>LAB_ffffffffc0a7ebcf</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>local_48</span> <span class=o>=</span> <span class=n>lVar7</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=n>uVar8</span> <span class=o>=</span> <span class=n>uVar8</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=n>ushort</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar1</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>          <span class=k>else</span> <span class=p>{</span>
</span></span><span class=line><span class=cl><span class=nl>LAB_ffffffffc0a7ebb8</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=p>(</span><span class=n>lVar1</span> <span class=o>!=</span> <span class=n>lVar6</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=o>*</span><span class=p>(</span><span class=kt>short</span> <span class=o>*</span><span class=p>)(</span><span class=n>local_48</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>short</span> <span class=o>*</span><span class=p>)(</span><span class=n>local_48</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>+</span> <span class=o>*</span><span class=p>(</span><span class=kt>short</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar1</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>              <span class=n>lVar7</span> <span class=o>=</span> <span class=n>local_48</span><span class=p>;</span>
</span></span><span class=line><span class=cl>              <span class=k>goto</span> <span class=n>LAB_ffffffffc0a7ebcf</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            <span class=n>local_4c</span> <span class=o>=</span> <span class=n>local_4c</span> <span class=o>-</span> <span class=p>(</span><span class=n>uint</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>ushort</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar6</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=n>uVar9</span> <span class=o>=</span> <span class=p>(</span><span class=n>ulong</span><span class=p>)</span><span class=n>local_4c</span><span class=p>;</span>
</span></span><span class=line><span class=cl>            <span class=nf>func_0xffffffffb92e7dc0</span><span class=p>(</span><span class=n>lVar6</span><span class=p>,(</span><span class=n>ulong</span><span class=p>)</span><span class=o>*</span><span class=p>(</span><span class=n>ushort</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar6</span> <span class=o>+</span> <span class=mh>0x10</span><span class=p>)</span> <span class=o>+</span> <span class=n>lVar6</span><span class=p>,</span><span class=n>uVar9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>          <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span> <span class=k>while</span> <span class=p>(</span><span class=n>uVar8</span> <span class=o>&lt;</span> <span class=n>uVar9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=mh>0x7fffffff</span> <span class=o>&lt;</span> <span class=n>uVar9</span><span class=p>)</span> <span class=k>goto</span> <span class=n>LAB_ffffffffc0a7ed2a</span><span class=p>;</span>
</span></span><span class=line><span class=cl>      <span class=p>}</span>
</span></span><span class=line><span class=cl>      <span class=nf>func_0xffffffffb8c57980</span><span class=p>(</span><span class=n>lVar6</span><span class=p>,</span><span class=n>uVar9</span><span class=p>,</span><span class=mi>1</span><span class=p>);</span>
</span></span><span class=line><span class=cl>      <span class=nf>func_0xffffffffb8e344a0</span><span class=p>(</span><span class=n>param_1</span><span class=p>,</span><span class=n>lVar6</span><span class=p>,</span><span class=n>uVar9</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=nl>LAB_ffffffffc0a7ecd0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nf>func_0xffffffffb8bb4680</span><span class=p>(</span><span class=n>lVar5</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=nf>func_0xffffffffb8bb4680</span><span class=p>(</span><span class=n>lVar6</span><span class=p>);</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=k>if</span> <span class=p>(</span><span class=n>local_38</span> <span class=o>==</span> <span class=o>*</span><span class=p>(</span><span class=kt>long</span> <span class=o>*</span><span class=p>)(</span><span class=n>in_GS_OFFSET</span> <span class=o>+</span> <span class=mh>0x28</span><span class=p>))</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=cm>/* WARNING: Bad instruction - Truncating control flow here */</span>
</span></span><span class=line><span class=cl>    <span class=nf>halt_baddata</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>func_0xffffffffb9336610</span><span class=p>();</span>
</span></span><span class=line><span class=cl>  <span class=k>return</span><span class=p>;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><p>We can see the followings :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=n>iVar4</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar5</span> <span class=o>+</span> <span class=mh>0x30</span><span class=p>);</span>  <span class=c1>// UID of the entry
</span></span></span><span class=line><span class=cl><span class=n>iVar2</span> <span class=o>=</span> <span class=o>*</span><span class=p>(</span><span class=kt>int</span> <span class=o>*</span><span class=p>)(</span><span class=n>lVar5</span> <span class=o>+</span> <span class=mh>0x34</span><span class=p>);</span>  <span class=c1>// GID of the entry
</span></span></span></code></pre></td></tr></table></div></div><p>So, it&rsquo;s reading the UID and GID of the file or process entry returned by <code>getdents64</code>.
Then, they compare them to the values stored at :</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-c data-lang=c><span class=line><span class=cl><span class=k>if</span> <span class=p>((</span><span class=n>DAT_ffffffffc0a80478</span> <span class=o>==</span> <span class=n>iVar4</span><span class=p>)</span> <span class=o>||</span> <span class=p>(</span><span class=n>lVar7</span> <span class=o>=</span> <span class=n>lVar1</span><span class=p>,</span> <span class=n>DAT_ffffffffc0a80474</span> <span class=o>==</span> <span class=n>iVar2</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    <span class=k>goto</span> <span class=n>LAB_ffffffffc0a7ebb8</span><span class=p>;</span>
</span></span></code></pre></td></tr></table></div></div><ul><li><code>DAT_ffffffffc0a80478</code> → UID to hide</li><li><code>DAT_ffffffffc0a80474</code> → GID to hide
If either matches the current entry’s UID or GID:</li><li>It <strong>skips showing that entry</strong> by jumping to a block (<code>LAB_ffffffffc0a7ebb8</code>) that merges/skips it.</li></ul><p><img alt="Ghidra screenshot" loading=lazy src=/img/ctf/driverShadow/xor.png></p><p>By looking at thoses values, we find :
GID -> DAT_ffffffffc0a80474 -> 000007C8h -> 1992
UID -> DAT_ffffffffc0a80478 -> 0000071Dh -> 1821</p><p>Flag: <code>1821:1992</code></p><h3 id=flag-1010---what-string-must-be-contained-in-a-file-in-order-to-be-hidden>Flag 10/10 - What string must be contained in a file in order to be hidden<a hidden class=anchor aria-hidden=true href=#flag-1010---what-string-must-be-contained-in-a-file-in-order-to-be-hidden>#</a></h3><p><img alt="String to hide a file" loading=lazy src=/img/ctf/driverShadow/string2.png></p><p>I don&rsquo;t really now how to link it with the program as I found it by chance..
<img alt=string.png loading=lazy src=/img/ctf/driverShadow/string.png>
Flag: <code>volnaya</code></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://www.noe.backert.fr/tags/forensics/>Forensics</a></li><li><a href=https://www.noe.backert.fr/tags/ram/>RAM</a></li><li><a href=https://www.noe.backert.fr/tags/volatility3/>Volatility3</a></li></ul></footer></article><nav class=paginav><a class=prev href=https://www.noe.backert.fr/ctf/silicondatasleuthing/><span class=title>« Prev</span><br><span>Silicon Data Sleuthing</span>
</a><a class=next href=https://www.noe.backert.fr/projects/aifuzzing/><span class=title>Next »</span><br><span>TranFuzz: AI Fuzzing and Black-Box Adversarial Attack Evaluation</span></a></nav></main><footer class=footer><span>&copy; 2026 <a href=https://www.noe.backert.fr/>Noé Backert | Blog</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
<a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentColor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script><script src=/js/lightbox.js></script><script src=/js/code-lang.js></script></body></html>